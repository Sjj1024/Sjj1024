"use strict";(globalThis.webpackChunkinfinity_hitab_client=globalThis.webpackChunkinfinity_hitab_client||[]).push([[2168],{72168:(t,i,s)=>{s.r(i),s.d(i,{useHistoryStore:()=>m,widgetInfo:()=>g});var e=s(10435),a=s(24581),h=s(28850),o=s(74003),r=s(88287);var n=s(80661),l=s.n(n),y=s(94119),c=s(63477);const g=(0,a.E0)(a.Rm.history),m=(0,e.Q_)(h.BU.history,{syncStorage:{watch:["historyList","lastTime","homePageNum"]},state:()=>({modalShow:!1,historyList:[],lastTime:0,homePageNum:1,homePageData:{}}),actions:{setModal(t){y.G.setStatus(a.Rm.history,t),this.modalShow=t},check(){var t;l()().isAfter(this.lastTime,"day")?this.queryHistoryList(l()().format("M/D")):this.getHistoryDetail(null===(t=this.historyList[this.homePageNum-1])||void 0===t?void 0:t.e_id)},async lastPage(){this.homePageNum>1&&(this.homePageNum-=1,this.homePageData=(await this.getHistoryDetail(this.historyList[this.homePageNum-1].e_id))[0])},async nextPage(){this.homePageNum<this.historyList.length&&(this.homePageNum+=1,this.homePageData=(await this.getHistoryDetail(this.historyList[this.homePageNum-1].e_id))[0])},async queryHistoryList(t){const[i,s]=await(async t=>{try{const i=await r.hj.get(`${o.H}history/list`,{date:t},{_delay:0});if(0===i.code&&i.data.length>0)return[null,i.data];throw i}catch(t){return["catch error"]}})(t);var e;i||(this.lastTime=Date.now(),this.homePageNum=1,this.historyList=s||[],this.getHistoryDetail(null===(e=this.historyList[this.homePageNum-1])||void 0===e?void 0:e.e_id))},async getHistoryDetail(t){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=this.historyList.findIndex((i=>i.e_id===t));let e;if(s>=0&&(e=this.historyList[s],e.content))return i&&(this.homePageData=e),[e];const[a,h=[]]=await(async t=>{try{const i=await r.hj.get(`${o.H}history/detail`,{id:t},{_delay:0});if(0===i.code&&i.data.length>0)return[null,i.data];throw i}catch(t){return["catch error"]}})(t);if(!a){var n;if(i)h[0].picUrl.length>0&&await(0,c.pt)(null===(n=h[0].picUrl[0])||void 0===n?void 0:n.url),this.homePageData=h[0];if(e){const t=JSON.parse(JSON.stringify(this.historyList));t[s]=Object.assign(e,h[0]),this.historyList=t}return h||[]}return[]}}})}}]);