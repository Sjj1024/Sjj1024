"use strict";(globalThis.webpackChunkinfinity_hitab_client=globalThis.webpackChunkinfinity_hitab_client||[]).push([[7352,9621],{78481:(t,e,l)=>{l.d(e,{_:()=>s,pg:()=>n,zu:()=>r});var o=l(74003),i=l(88287),a=l(63477);const s=async t=>{try{var e;const l=await i.hj.get(`${o.H}stock/hq`,{codes:t},{_delay:0});if(0===l.rc&&(null===(e=l.data.diff)||void 0===e?void 0:e.length)>0)return[null,l.data.diff];throw l}catch(t){return["catch error"]}},n=async t=>{try{const e=await i.hj.get(`${o.H}stock/search`,{key:t},{_delay:0});if(e.QuotationCodeTable.Data&&e.QuotationCodeTable.Data.length>0)return[null,e.QuotationCodeTable.Data];throw e}catch(t){return["catch error"]}},r=async t=>{try{const e=await i.hj.get(`${o.H}stock/kline`,t,{_delay:0});if(0===e.rc&&e.data.klines)return[null,e.data.klines];throw e}catch(t){return["catch error"]}};new a._P("stock/chart-data",18e5)},73186:(t,e,l)=>{l.d(e,{O9:()=>u,ST:()=>w,XM:()=>x,dJ:()=>k,f8:()=>D,hQ:()=>b,o7:()=>C,t4:()=>h,zY:()=>d});var o=l(994),i=l(80661),a=l.n(i),s=l(74003),n=l(63477),r=l(55332),c=l(27542);const u={font:["rgba(248, 248, 248, 1)","rgba(28, 28, 30, 1)","rgba(58, 58, 60, 1)","rgba(95, 95, 99, 1)","rgba(142, 142, 147, 1)","rgba(176, 176, 182, 1)","rgba(199, 199, 204, 1)"],background:["rgba(248, 248, 248, 1)","rgba(58, 58, 60, 1)","rgba(28, 28, 30, 1)","rgba(244, 171, 18, 1)","rgba(74, 197, 92, 1)","rgba(35, 207, 168, 1)","rgba(67, 133, 241, 1)","rgba(56, 100, 255, 1)","rgba(118, 33, 249, 1)","rgba(224, 78, 150, 1)","rgba(224, 78, 78, 1)","rgba(253, 90, 90, 1)","rgba(183, 163, 150, 1)","rgba(171, 131, 131, 1)","rgba(182, 150, 135, 1)","rgba(109, 131, 95, 1)","rgba(125, 171, 136, 1)","rgba(158, 172, 175, 1)","rgba(103, 124, 170, 1)"]},p=["rgba(183, 163, 150, 1)","rgba(171, 131, 131, 1)","rgba(182, 150, 135, 1)","rgba(109, 131, 95, 1)","rgba(125, 171, 136, 1)","rgba(158, 172, 175, 1)","rgba(103, 124, 170, 1)"],d=()=>(0,o.Z)(p),h=Array(20).fill(0).map(((t,e)=>{const l=`${e+1}`.padStart(2,"0");return{bgImage:{large:`${s.c1}/widget-background/background${l}_larg.jpg`,medium:`${s.c1}/widget-background/background${l}_medium.jpg`,small:`${s.c1}/widget-background/background${l}_small.jpg`},thumbnail:`${s.c1}/widget-background/background${l}.jpg`}})),v=(t,e)=>{let l=!1;t.isLeapYear()&&1===t.month()&&29===t.date()&&(l=!0);let o=(0,n.sG)(t.format(`${e}-MM-DD`));return l&&!o.isLeapYear()&&(o=o.add(-1,"day")),o.valueOf()>=y.valueOf()||(o=(0,n.sG)(t.format(`${e+1}-MM-DD`)),l&&!o.isLeapYear()&&(o=o.add(-1,"day"))),o},m=t=>{const e=r.q7.fromDate(new Date(t)),l=r.q7.fromDate(new Date).getYear(),o=a()((0,n.EJ)({year:l,month:e.getMonth(),day:e.getDay()}));return o.valueOf()>=y.valueOf()?o:a()((0,n.EJ)({year:l+1,month:e.getMonth(),day:e.getDay()}))},g=t=>{if(t.date()>=y.date())return(0,n.sG)(`${y.year()}-${y.month()+1}-${Math.min(y.daysInMonth(),t.date())}`);const e=y.add(1,"month");return(0,n.sG)(`${e.year()}-${e.month()+1}-${Math.min(e.daysInMonth(),t.date())}`)},f=t=>{const e=r.q7.fromDate(new Date),l=r.q7.fromDate(new Date(t)),o=e.getDay(),i=l.getDay();if(i>=o)return a()((0,n.EJ)({year:e.getYear(),month:e.getMonth(),day:i}));const s=r.o7.fromYm(e.getYear(),e.getMonth()).next(1);return a()((0,n.EJ)({year:s.getYear(),month:s.getMonth(),day:i}))},w=t=>{const e=Date.now(),l=a()().endOf("day").valueOf()+1;return window.setTimeout((()=>{try{t(l),w(t)}catch(t){}}),l-e)},x=t=>{const e=Date.now(),l=a()().add(30,"minute").valueOf();return window.setTimeout((()=>{try{t(l),x(t)}catch(t){}}),l-e)};let y=a()().startOf("day"),S=y.year();w((()=>{y=a()(),S=y.year()}));const k=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"solar";if(!t)return 0;if(t>=y.valueOf())return a()(t).diff(y,"day");if("lunar"===e){return f(t).diff(y,"day")}const l=a()(t),o=g(l),i=o.diff(y,"day");return i},b=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"solar";if(!t)return 0;if(t>=y.valueOf())return a()(t).diff(y,"day");if("lunar"===e){return m(t).diff(y,"day")}const l=a()(t),o=v(l,S),i=o.diff(y,"day");return i},D=t=>{const e=Math.floor(t/86400);t-=86400*e;const l=Math.floor(t/3600)%24;t-=3600*l;const o=Math.floor(t/60)%60;return{d:e,h:l,m:o,s:(t-=60*o)%60}};class C{views=new Map;execTime=0;execTimer=null;isPageVisible=!0;setViewVisibleInterval(){0!==this.views.size?this.isPageVisible?this.isViewVisible?this.setInterval(this.interval):this.setInterval(this.intervalOnViewOut):this.setPageVisibleInterval():this.setInterval(0)}setPageVisibleInterval(){0!==this.views.size?this.isPageVisible?this.setViewVisibleInterval():this.setInterval(this.intervalOnPageHide):this.setInterval(0)}setInterval(t){if(this.execTimer&&window.clearTimeout(this.execTimer),t<=0)return;let e=t;this.execTime&&(e=t-(Date.now()-this.execTime),e<0&&(e=0)),this.execTimer=window.setTimeout((async()=>{await this.execFn(),this.setInterval(t)}),e)}watchPageStatus(){c.Z.addEventListener("statechange",(t=>{"hidden"===t.newState?this.isPageVisible=!1:this.isPageVisible=!0,this.setPageVisibleInterval()}))}onChangeViewVisible(){let t=!1;this.views.forEach((e=>{t||(t=e)})),this.isViewVisible=t,this.setViewVisibleInterval()}initIo(){this.io=new IntersectionObserver((t=>{t.forEach((t=>{this.views.has(t.target)&&this.views.set(t.target,t.intersectionRatio>0)})),this.onChangeViewVisible()}),{threshold:[0]})}constructor(t,e){if(!e.interval)throw new Error("请设置间隔时间");this.interval=e.interval,this.intervalOnViewOut=e.intervalOnViewOut,this.intervalOnPageHide=e.intervalOnPageHide,this.execFn=async()=>{try{await t()}catch(t){}this.execTime=Date.now()},e.immediate&&this.execFn(),this.watchPageStatus(),this.initIo(),e.view&&this.addView(e.view)}addView(t){this.views.set(t,!1),this.io.observe(t)}removeView(t){this.views.delete(t),this.io.unobserve(t),this.onChangeViewVisible()}}},22854:(t,e,l)=>{l.d(e,{C:()=>a});var o=l(29445),i=l(57268);const a=(t,e,l)=>{const a=(0,o.iH)(t);e.onChangeState=t=>{a.value={...t}};const s=(0,i.Fl)((()=>l?l[a.value.size]:null));return{propsState:a,HomeComp:s}}},58832:(t,e,l)=>{l.r(e),l.d(e,{mountHome:()=>v,widgetApp:()=>h});var o=l(29445),i=l(68398),a=l(57268),s=l(81293),n=l(73186);const r=(0,l(39621).useStockStore)(),c=new n.o7((()=>{r.reqStocksPrice()}),{immediate:!1,interval:5e3,intervalOnPageHide:0,intervalOnViewOut:12e5}),u=(0,a.aZ)({__name:"widget-stock-home",props:{size:null,id:null},setup(t){const e=t,{HomeComp:l}=(0,s.fq)(e),{clickWidget:i}=(0,s.dd)(),n=(0,o.iH)();return(0,a.bv)((()=>{n.value&&c.addView(n.value)})),(0,a.Jd)((()=>{c.removeView(n.value)})),(t,e)=>((0,a.wg)(),(0,a.iD)("section",{class:"contents cursor-pointer",onClick:e[0]||(e[0]=function(){return(0,o.SU)(i)&&(0,o.SU)(i)(...arguments)})},[(0,a._)("div",{ref_key:"componentView",ref:n,class:"h-full w-full"},[((0,a.wg)(),(0,a.j4)((0,a.LL)((0,o.SU)(l))))],512)]))}});var p=l(96755),d=l(75008);const h=(0,o.iH)(null),v=(t,e)=>{const l=(0,i.createApp)(u,e);return(0,d.f)(l),h.value=l,l.use(p.M),l.mount(t),h.value}},39621:(t,e,l)=>{l.r(e),l.d(e,{useStockStore:()=>u});const o=[{QuoteID:"1.000001",Code:"000001",Name:"上证指数",Classify:"Index",MktNum:"1",SecurityTypeName:"指数",trend:"up"},{QuoteID:"0.399001",Code:"399001",Name:"深证成指",Classify:"Index",MktNum:"0",SecurityTypeName:"指数",trend:"up"},{QuoteID:"0.399006",Code:"399006",Name:"创业板指",Classify:"Index",MktNum:"0",SecurityTypeName:"指数",trend:"up"},{QuoteID:"100.HSI",Code:"HSI",Name:"恒生指数",Classify:"HK",MktNum:"100",SecurityTypeName:"指数",trend:"down"}];var i=l(28850),a=l(10435),s=l(78481),n=l(94119),r=l(24581),c=l(57268);const u=(0,a.Q_)(i.BU.stock,{syncStorage:{watch:["followStocks","trendChartData","hqData"]},syncCloud:{watch:["followStocks"]},state:()=>({modalShow:!1,stockColor:{up:"#FF4D4F",down:"#34C759"},trendChartData:{},followStocks:o,hqData:{},flipping:!1,flipingTimer:null,dragId:""}),getters:{fullStateFollowStocks(){return this.followStocks.map((t=>{var e,l;return{...t,trend:(null===(e=this.hqData[t.QuoteID])||void 0===e?void 0:e.f4)>=0?"up":"down",hq:this.hqData[t.QuoteID]||{},chartData:(null===(l=this.trendChartData[t.QuoteID])||void 0===l?void 0:l.data)||[]}}))},topFourSecidStr(){let t=this.followStocks.map((t=>t.QuoteID));return t.length>4&&(t=t.slice(0,4)),t.sort(),t}},actions:{setModal(t){n.G.setStatus(r.Rm.stock,t),this.modalShow=t},setFollowStocks(t){this.followStocks=t},setDragId(t){this.dragId=t},async reqStocksPrice(){const t=this.followStocks.map((t=>t.QuoteID)),[e,l]=await(0,s._)(t.join(","));if(e||!l)return;const o={};this.followStocks.forEach(((t,e)=>{o[t.QuoteID]=l[e]})),this.hqData=o},async getHomeChartData(t){const e=this.trendChartData[t],l=(new Date).valueOf();if(e&&l-e.updateTime<36e5)return e.data;const[o,i]=await(0,s.zu)({secid:t,klt:5,lmt:60});return o||!i?null:i.map((t=>{const e=t.split(","),l=Number(e[2]);return{time:e[0],value:l}}))},async reqStockTrendData(){const t=this.topFourSecidStr.map((async t=>await this.getHomeChartData(t))),e=await Promise.all(t),l=Object.assign({},this.trendChartData);this.topFourSecidStr.forEach(((t,o)=>{e[o]&&(l[t]={updateTime:(new Date).valueOf(),data:e[o]})})),this.trendChartData=l},dragSort(t,e){if(t===e)return;const l=[...this.followStocks],o=l.findIndex((t=>e===t.QuoteID)),i=l.findIndex((e=>t===e.QuoteID));-1!==o&&-1!==i&&(o>i?(l.splice(o+1,0,l[i]),l.splice(i,1)):(l.splice(o,0,l[i]),l.splice(i+1,1)),this.setFollowStocks(l),this.setFlipping(!0))},setFlipping(t){window.clearTimeout(this.flipingTimer),t&&(this.flipping=t,this.flipingTimer=window.setTimeout((()=>{this.flipping=!1}),200))}}}),p=u(),d=(0,a.Jk)(p);(0,c.YP)((()=>d.topFourSecidStr.value.join(",")),(()=>{p.reqStockTrendData(),p.reqStocksPrice()}),{immediate:!1})},81293:(t,e,l)=>{l.d(e,{DS:()=>K,st:()=>L,dd:()=>J,UV:()=>W,fq:()=>z});var o=l(57268),i=l(94209),a=l(29445),s=l(68398);const n={class:"relative flex h-full flex-row items-center justify-between bg-color-b3 px-[16px] leading-none icon-m:px-[12px] icon-s:px-[12px]"},r={class:"flex-1 overflow-hidden pr-[5px]"},c={class:"text-dot font-ali-75 text-[16px] text-color-t1"},u={class:"mt-[4px] text-[12px] text-color-t3"},p={class:"flex flex-col"},d={class:"flex justify-end font-ali-75 text-[14px] text-color-t2"},h=(0,o.aZ)({__name:"stock-small",setup(t){const{firstData:e,stockColor:l}=K();return(t,h)=>{var v,m,g,f,w,x,y,S,k,b,D,C,_,I;return(0,o.wg)(),(0,o.iD)("section",n,[(0,o._)("div",r,[(0,o._)("h2",c,(0,i.toDisplayString)(null===(v=(0,a.SU)(e))||void 0===v?void 0:v.Name),1),(0,o._)("p",u,(0,i.toDisplayString)(null===(m=(0,a.SU)(e))||void 0===m?void 0:m.SecurityTypeName)+" "+(0,i.toDisplayString)(null===(g=(0,a.SU)(e))||void 0===g?void 0:g.Code),1)]),(0,o._)("div",p,[(0,o._)("h3",d,(0,i.toDisplayString)(null===(f=(0,a.SU)(e))||void 0===f||null===(w=f.hq)||void 0===w?void 0:w.f2),1),(0,o._)("div",{class:"mt-[7px] flex justify-end font-ali-65 text-[12px]",style:(0,i.normalizeStyle)({color:(0,a.SU)(l)(null===(x=(0,a.SU)(e))||void 0===x?void 0:x.trend)})},[(0,o._)("span",null,(0,i.toDisplayString)("up"===(null===(y=(0,a.SU)(e))||void 0===y?void 0:y.trend)?"+":null)+(0,i.toDisplayString)(null===(S=(0,a.SU)(e))||void 0===S||null===(k=S.hq)||void 0===k?void 0:k.f4),1),(0,o.wy)((0,o._)("span",{class:"ml-[6px]"},(0,i.toDisplayString)("up"===(null===(b=(0,a.SU)(e))||void 0===b?void 0:b.trend)?"+":null)+(0,i.toDisplayString)(null===(D=(0,a.SU)(e))||void 0===D||null===(C=D.hq)||void 0===C?void 0:C.f3)+"% ",513),[[s.vShow,null===(_=(0,a.SU)(e))||void 0===_||null===(I=_.hq)||void 0===I?void 0:I.f3]])],4)])])}}}),v={class:"relative flex h-full flex-col bg-color-b3"},m={class:"p-[20px] pb-[0px] leading-none icon-m:p-[16px] icon-m:pb-[0px] icon-s:p-[12px] icon-s:pb-[0px]"},g={class:"flex items-start justify-between"},f={class:"flex flex-1 flex-shrink-0 flex-col overflow-hidden pr-[10px]"},w={class:"text-dot font-ali-75 text-[16px] text-color-t1"},x={class:"mt-[10px] font-ali-55 text-[12px] text-color-t3"},y={class:"flex-1 p-[20px] icon-m:p-[16px] icon-s:p-[12px]"},S={class:"flex h-full flex-col justify-between rounded-[12px] bg-color-b4 pt-[12px] icon-m:pt-[10px] icon-s:pt-[9px]"},k={class:"flex justify-center pb-[12px] font-ali-75 text-[28px] text-color-t2 icon-m:pb-[8px] icon-s:pb-[4px]"},b=(0,o.aZ)({__name:"stock-medium",setup(t){const{firstData:e,stockColor:l,chartRef:n}=K();return(t,r)=>{var c,u,p,d,h,b,D,C,_,I,F,T,j;return(0,o.wg)(),(0,o.iD)("section",v,[(0,o._)("div",m,[(0,o._)("div",g,[(0,o._)("div",f,[(0,o._)("span",w,(0,i.toDisplayString)(null===(c=(0,a.SU)(e))||void 0===c?void 0:c.Name),1),(0,o._)("p",x,(0,i.toDisplayString)(null===(u=(0,a.SU)(e))||void 0===u?void 0:u.SecurityTypeName)+" "+(0,i.toDisplayString)(null===(p=(0,a.SU)(e))||void 0===p?void 0:p.Code),1)]),(0,o._)("div",{class:"flex justify-end font-ali-65 text-[14px] icon-m:flex-col icon-s:flex-col",style:(0,i.normalizeStyle)({color:(0,a.SU)(l)(null===(d=(0,a.SU)(e))||void 0===d?void 0:d.trend)})},[(0,o._)("span",null,(0,i.toDisplayString)("up"===(null===(h=(0,a.SU)(e))||void 0===h?void 0:h.trend)?"+":null)+(0,i.toDisplayString)(null===(b=(0,a.SU)(e))||void 0===b||null===(D=b.hq)||void 0===D?void 0:D.f4),1),(0,o.wy)((0,o._)("span",{class:"ml-[6px] icon-m:ml-[0px] icon-m:mt-[10px] icon-s:ml-[0px] icon-s:mt-[10px]"},(0,i.toDisplayString)("up"===(null===(C=(0,a.SU)(e))||void 0===C?void 0:C.trend)?"+":null)+(0,i.toDisplayString)(null===(_=(0,a.SU)(e))||void 0===_||null===(I=_.hq)||void 0===I?void 0:I.f3)+"% ",513),[[s.vShow,null===(F=(0,a.SU)(e))||void 0===F||null===(T=F.hq)||void 0===T?void 0:T.f3]])],4)])]),(0,o._)("div",y,[(0,o._)("div",S,[(0,o._)("div",{ref_key:"chartRef",ref:n,class:"h-[50px] w-full overflow-hidden"},null,512),(0,o._)("div",k,[(0,o._)("span",null,(0,i.toDisplayString)(null===(j=(0,a.SU)(e).hq)||void 0===j?void 0:j.f2),1)])])])])}}});var D=l(38966);const C={class:"flex h-[50px] items-center justify-between leading-none icon-m:h-[60px] icon-s:h-[56px]"},_={class:"flex-1 flex-shrink-0 overflow-hidden pr-[16px]"},I={class:"text-dot font-ali-75 text-[16px] text-color-t1"},F={class:"mt-[4px] font-ali-55 text-[12px] text-color-t3"},T={class:"flex items-center"},j={class:"ml-[20px] w-[90px] icon-m:ml-[15px] icon-s:ml-[10px]"},V={class:"flex justify-end font-ali-75 text-[14px] leading-[16px] text-color-t2"},P=(0,o.aZ)({__name:"stock-home-item",props:{item:null},setup(t){const e=t,{stockColor:l}=L();let n;const r=(0,a.iH)();function c(){if(!r.value)return;const t=e.item.chartData;t&&(n?n.changeData(t):(n=new D.kL({container:r.value,autoFit:!0,height:20,width:100}),n.data(t),n.scale({value:{nice:!0}}),n.tooltip(!1),n.axis(!1),n.line().style({lineWidth:2,stroke:l(e.item.trend)}).position("time*value"),n.render()))}return(0,o.bv)((()=>{c()})),(0,o.YP)((()=>e.item.chartData),(()=>{c()}),{immediate:!0}),(0,o.YP)((()=>e.item.trend),(()=>{n.clear();const t=e.item.chartData;n.data(t),n.line().style({lineWidth:2,stroke:l(e.item.trend)}).position("time*value"),n.render()}),{immediate:!1}),(t,n)=>{var c,u,p,d,h;return(0,o.wg)(),(0,o.iD)("div",C,[(0,o._)("div",_,[(0,o._)("h2",I,(0,i.toDisplayString)(e.item.Name),1),(0,o._)("p",F,(0,i.toDisplayString)(e.item.SecurityTypeName)+" "+(0,i.toDisplayString)(e.item.Code),1)]),(0,o._)("div",T,[(0,o._)("div",{ref_key:"chartRef",ref:r,class:"h-[20px] w-[100px]"},null,512),(0,o._)("div",j,[(0,o._)("h2",V,(0,i.toDisplayString)(null===(c=e.item.hq)||void 0===c?void 0:c.f2),1),(0,o._)("div",{class:"mt-[4px] flex justify-end font-ali-65 text-[12px]",style:(0,i.normalizeStyle)({color:(0,a.SU)(l)(null===(u=e.item)||void 0===u?void 0:u.trend)})},[(0,o._)("span",null,(0,i.toDisplayString)("up"===e.item.trend?"+":null)+(0,i.toDisplayString)(null===(p=e.item.hq)||void 0===p?void 0:p.f4),1),(0,o.wy)((0,o._)("span",{class:"ml-[6px]"},(0,i.toDisplayString)("up"===e.item.trend?"+":null)+(0,i.toDisplayString)(null===(d=e.item.hq)||void 0===d?void 0:d.f3)+"% ",513),[[s.vShow,null===(h=e.item.hq)||void 0===h?void 0:h.f3]])],4)])])])}}}),q={class:"relative flex h-full flex-col overflow-hidden bg-color-b3 px-[24px] py-[18px] icon-m:py-[12px] icon-m:px-[20px] icon-s:py-[6px] icon-s:px-[16px]"},H=(0,o.aZ)({__name:"stock-large",setup(t){const{homeData:e}=L();return(t,l)=>((0,o.wg)(),(0,o.iD)("section",q,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)((0,a.SU)(e),((t,e)=>((0,o.wg)(),(0,o.iD)("div",{key:t.QuoteID,class:(0,i.normalizeClass)(["border-b border-solid border-color-m2 border-opacity-5 last:border-0",[e>1?"icon-m:border-0 icon-s:border-0":""]])},[(0,o.Wm)(P,{item:t},null,8,["item"])],2)))),128))]))}});var M=l(58832),N=l(22854),U=l(39621),O=l(10435),Q=l(48885),E=l(78481),$=l(17319),Y=l(62659);const z=t=>{const e={s:h,m:b,l:H};return(0,N.C)(t,M.widgetApp.value,e)},J=()=>{const t=(0,U.useStockStore)();return{clickWidget:()=>{t.setModal(!0)},onCloseModal:()=>{t.setModal(!1)},show:(0,O.Jk)(t).modalShow}},K=()=>{const t=(0,U.useStockStore)(),e=(0,O.Jk)(t),l=(0,a.iH)(),i=(0,o.Fl)((()=>t.fullStateFollowStocks[0]));let s;const n=t=>"up"===t?e.stockColor.value.up:e.stockColor.value.down,r=()=>{if(!l.value)return;const t=i.value.chartData;t&&(s?s.changeData(t):(s=new D.kL({container:l.value,autoFit:!0,height:50}),s.data(t),s.scale({value:{nice:!0}}),s.tooltip(!1),s.axis(!1),s.line().style({lineWidth:2,stroke:n(i.value.trend)}).position("time*value"),s.render()))};return(0,o.YP)((()=>Y.EA.value),(()=>{s&&s.forceFit()})),(0,o.YP)((()=>i.value.trend),(()=>{if(s){const t=i.value.chartData;s.clear(),s.data(t),s.line().style({lineWidth:2,stroke:n(i.value.trend)}).position("time*value"),s.render()}})),(0,o.YP)((()=>i.value.chartData),(()=>{s&&r()})),(0,o.bv)((()=>{r()})),(0,o.YP)((()=>i.value.trend),(()=>{r()})),{stockColor:n,firstData:i,chartRef:l}},L=()=>{const t=(0,U.useStockStore)(),e=(0,O.Jk)(t);return{stockColor:t=>"up"===t?e.stockColor.value.up:e.stockColor.value.down,homeData:(0,o.Fl)((()=>e.fullStateFollowStocks.value.length>4?e.fullStateFollowStocks.value.slice(0,4):e.fullStateFollowStocks.value))}};function R(t){const e=(0,U.useStockStore)(),l=(0,O.Jk)(e),o=t.split(","),i=Number(o[8]),a=i>0?l.stockColor.value.up:l.stockColor.value.down;return{time:o[0],open:Number(o[1]),close:Number(o[2]),heigh:Number(o[3]),low:Number(o[4]),cjl:Number(o[5]),cje:Number(o[6]),zf:Number(o[7]),risePercent:i>0?"+"+o[8]:o[8],rise:i>0?"+"+o[9]:o[9],hs:Number(o[10]),color:a}}const W=()=>{const t=(0,U.useStockStore)(),e=(0,O.Jk)(t),l=(0,a.iH)(!1),i=(0,a.iH)([]),s=(0,a.iH)(e.fullStateFollowStocks.value[0]),n=(0,a.iH)(!0),r=(0,a.iH)(!1),c=(0,a.iH)(""),u=(0,a.iH)(!1);let p;const d=(0,a.iH)(),h=(0,a.iH)("分时");const v=(0,Q.Z)((async t=>{u.value=!1;const{value:e}=t.target;if(!e)return void(i.value=[]);const[l,o]=await(0,E.pg)(e);if(l||!o)return i.value=[],void(u.value=!0);u.value=!1;const a=o.map((t=>t.QuoteID)),[s,n]=await(0,E._)(a);if(s||!n)return;const r=o.map(((t,e)=>({...t,trend:n[e].f4>=0?"up":"down",hq:n[e]})));i.value=r}),800),m=t=>{l.value=!1,s.value.QuoteID!==t.QuoteID&&(s.value=t,h.value="分时",f(80,1))};async function g(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:80,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const l=s.value.QuoteID,[o,i]=await(0,E.zu)({secid:l,lmt:t,klt:e});if(o||!i)return!1;const a=[];return i.forEach((t=>{a.push(R(t))})),a}async function f(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:80,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!d.value)return;const l=await g(t,e);l&&(p&&p.destroy(),p=new D.kL({container:d.value,autoFit:!0,width:604,height:320}),p.data(l),p.scale({open:{nice:!0,tickCount:0,range:[.1,.9]}}),p.tooltip({showTitle:!1,showCrosshairs:!0,showMarkers:!1,crosshairs:{type:"xy",follow:!0,line:{style:{lineDash:[2,2]}}},containerTpl:'<div class="g2-tooltip"><p class="g2-tooltip-title"></p><ul class="g2-tooltip-list"></ul></div>',itemTpl:'   \n            <ul class="g2-tooltip-list">\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">时间</span><span class="g2-tooltip-value">{time}</span>\n              </li>\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">价格</span><span class="g2-tooltip-value" style="color:{color}">{close}</span>\n              </li>\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">涨跌额</span><span class="g2-tooltip-value" style="color:{color}">{rise}</span>\n              </li>\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">涨跌幅</span><span class="g2-tooltip-value" style="color:{color}">{risePercent}%</span>\n              </li>\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">成交量</span><span class="g2-tooltip-value">{cjl}</span>\n              </li>\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">成交额</span><span class="g2-tooltip-value">{cje}</span>\n              </li>\n            </ul>\n          '}),p.axis(!1),p.area().style({fill:"l(90) 0:#8499EF 0.6:#8499EF 1:#ffffff"}).position("time*open"),p.line().style({lineWidth:1,stroke:"#8499EF"}).position("time*open").tooltip("time*open*close*rise*risePercent*cjl*cje*color",((t,e,l,o,i,a,s,n)=>({time:t,open:e,close:l,rise:o,risePercent:i,cjl:a,cje:s,color:n}))),p.render())}const w=(0,o.Fl)((()=>!!e.followStocks.value.find((t=>t.QuoteID===s.value.QuoteID))));return(0,o.YP)((()=>e.modalShow.value),(t=>{t&&(0,o.Y3)((()=>{p||f(80,1),n.value&&(s.value=e.fullStateFollowStocks.value[0],n.value=!1)}))})),{followList:e.fullStateFollowStocks,stockColor:t=>"up"===t?e.stockColor.value.up:e.stockColor.value.down,onClickEdit:t=>{l.value=t},isEdit:l,onClickRemove:(o,i)=>{const a=[...e.followStocks.value];if(1===a.length)return $.R.fail({message:"请至少保留一条数据"}),l.value=!1,!1;a.splice(o,1),i.QuoteID===s.value.QuoteID&&(s.value=a[0],h.value="分时",f(80,1)),t.setFollowStocks(a)},onInputSearchKey:v,isEmpty:u,searchResult:i,onClickSearchItem:function(t){r.value=!0,m(t)},currentStock:s,onSelectStock:m,kltArr:[{text:"分时",klt:1,lmt:80},{text:"5日",klt:5,lmt:250},{text:"日K",klt:101,lmt:60},{text:"周K",klt:102,lmt:60},{text:"月K",klt:103,lmt:60},{text:"1年",klt:101,lmt:250}],onSelectKlt:t=>{l.value=!1,h.value!==t.text&&(h.value=t.text,t.text.indexOf("K")>0?async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:101;if(!d.value)return;const l=await g(t,e);if(!l)return;l.forEach((t=>{t.range=[t.open,t.close,t.heigh,t.low]})),p&&p.destroy(),p=new D.kL({container:d.value,autoFit:!0,width:604,height:320}),p.data(l),p.scale({time:{type:"timeCat"},range:{nice:!0,range:[.1,.9]},close:{nice:!0,range:[.1,.9]}}),p.axis("range",!1),p.tooltip({showTitle:!1,showCrosshairs:!0,showMarkers:!1,crosshairs:{type:"xy",follow:!0,line:{style:{lineDash:[2,2]}}},containerTpl:'<div class="g2-tooltip"><p class="g2-tooltip-title"></p><ul class="g2-tooltip-list"></ul></div>',itemTpl:'\n            <ul class="g2-tooltip-list">\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">时间</span><span class="g2-tooltip-value">{time}</span>\n              </li>\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">价格</span><span class="g2-tooltip-value" style="color:{color}">{close}</span>\n              </li>\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">涨跌额</span><span class="g2-tooltip-value" style="color:{color}">{rise}</span>\n              </li>\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">涨跌幅</span><span class="g2-tooltip-value" style="color:{color}">{risePercent}%</span>\n              </li>\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">最高价</span><span class="g2-tooltip-value">{heigh}</span>\n              </li>\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">最低价</span><span class="g2-tooltip-value">{low}</span>\n              </li>\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">成交量</span><span class="g2-tooltip-value">{cjl}</span>\n              </li>\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">成交额</span><span class="g2-tooltip-value">{cje}</span>\n              </li>\n              <li class="g2-tooltip-list-item">\n               <span class="g2-tooltip-name">换手率</span><span class="g2-tooltip-value">{hs}%</span>\n              </li>\n            </ul>\n          '}),p.legend(!1),p.axis("close",{label:{formatter:t=>{const e=parseFloat(t);return Number(e.toFixed(2))}}}),p.line().style({lineWidth:1,stroke:"#8499EF"}).position("time*close").tooltip("time*open*close*rise*risePercent*cjl*cje*color*heigh*low*zf*hs",((t,e,l,o,i,a,s,n,r,c,u,p)=>({time:t,open:e,close:l,rise:o,risePercent:i,cjl:a,cje:s,color:n,heigh:r,low:c,zf:u,hs:p}))),p.schema().color("color",(t=>t)).position("time*range").shape("candle"),p.render()}(t.lmt,t.klt):f(t.lmt,t.klt))},currentKlt:h,chartRef:d,searchKey:c,onClearSearchKey:()=>{c.value="",i.value=[],r.value=!1},onClickSearch:function(){l.value=!1},isInFollow:w,onClickAddToFollow:function(){const l=[...e.followStocks.value,s.value];t.setFollowStocks(l)},isSearch:r,onClickFollowItem:function(t){r.value=!1,m(t)}}}}}]);