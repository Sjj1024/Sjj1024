"use strict";(globalThis.webpackChunkinfinity_hitab_client=globalThis.webpackChunkinfinity_hitab_client||[]).push([[3668],{43670:(s,e,o)=>{o.d(e,{B:()=>a});var r=o(74003),i=o(97432);const a=new class{hasPermission=async()=>new Promise((s=>{if(!r.Pl)return chrome.permissions.contains({permissions:["system.cpu","system.memory"]},(e=>{s(e)}));s(!1)}));reqPermission=async()=>new Promise((s=>{r.Pl?s(!1):chrome.permissions.request({permissions:["system.cpu","system.memory"]},(e=>{chrome.runtime.lastError?s(!1):s(e)}))}));hasBookmarksPermission=async()=>new Promise((s=>{if(!r.Pl)return chrome.permissions.contains({permissions:["bookmarks","favicon"]},(e=>{chrome.runtime.lastError?chrome.permissions.contains({permissions:["bookmarks"]},(e=>{s(e)})):s(e)}));s(!1)}));reqBookmarksPermission=async()=>new Promise((s=>{r.Pl?s(!1):chrome.permissions.request({permissions:["bookmarks","favicon"]},(e=>{chrome.runtime.lastError?"'favicon' is not a recognized permission."==chrome.runtime.lastError.message?((0,i.useBookmarksStore)().setFavicon(!0),chrome.permissions.request({permissions:["bookmarks"]},(e=>{s(e)}))):s(!1):s(e)}))}));getCpuInfo=()=>chrome.system.cpu.getInfo();getStorageInfo=()=>chrome.system.storage.getInfo();getMemoryInfo=()=>chrome.system.memory.getInfo()}},97432:(s,e,o)=>{o.r(e),o.d(e,{useBookmarksStore:()=>k});var r=o(43670),i=o(28850),a=o(10435),t=o(87322);const n=async(s,e)=>{await chrome.bookmarks.move(s,e)},m=async s=>{await(0,t.stopBrowserListening)(),await Promise.all(s.map((async s=>{await(async s=>{await chrome.bookmarks.remove(s)})(s)}))),await(0,t.startBrowserListening)()};var c=o(81220);const k=(0,a.Q_)(i.BU.bookmarks,{syncStorage:{watch:["isFirst","bookmarks","flattenBookmarks","folderList","needInfinityFavicon"]},state:()=>({isFullScreen:!1,isFirst:!0,modalShow:!1,hasPermission:!1,bookmarks:[],flattenBookmarks:[],folderList:[],needInfinityFavicon:!1}),actions:{setModal(s){this.modalShow=s},setBookmarks(s){this.bookmarks=s},setIsFirst(s){this.isFirst=s},setIsFullScreen(s){this.isFullScreen=s},async getAllData(){if(this.hasPermission=await r.B.hasBookmarksPermission(),!this.hasPermission)return;const[s,e,o]=await(0,c.jl)();this.bookmarks=s,this.flattenBookmarks=e,this.folderList=o},setFaviconById(s,e){this.bookmarks=[...(0,c.Ob)(this.bookmarks,e,{favicon:s})],this.flattenBookmarks=(0,c.Qj)(this.bookmarks),this.folderList=(0,c.Ln)(this.flattenBookmarks)},async reqPermission(){return this.hasPermission=await r.B.reqBookmarksPermission(),this.hasPermission},async batchMoveBookmark(s,e){await(async(s,e)=>{await(0,t.stopBrowserListening)(),await Promise.all(s.map((async s=>{await n(s,e)}))),await(0,t.startBrowserListening)()})(s,e),this.getAllData()},async batchRemoveBookmark(s){await m(s),this.getAllData()},async updateBookmark(s,e){await(async(s,e)=>{await(0,t.stopBrowserListening)(),await chrome.bookmarks.update(s,e),await(0,t.startBrowserListening)()})(s,{title:e.title,url:e.url}),e.parentId&&await n(s,{parentId:e.parentId}),this.getAllData()},setFavicon(s){this.needInfinityFavicon=s}}})},87322:(s,e,o)=>{o.r(e),o.d(e,{startBrowserListening:()=>m,stopBrowserListening:()=>c});var r=o(43670),i=o(97432);const a=(s,e)=>{(0,i.useBookmarksStore)().getAllData()},t=(s,e)=>{(0,i.useBookmarksStore)().getAllData()},n=(s,e)=>{(0,i.useBookmarksStore)().getAllData()},m=async()=>{await r.B.hasBookmarksPermission()&&(chrome.bookmarks.onCreated.addListener(a),chrome.bookmarks.onChanged.addListener(t),chrome.bookmarks.onRemoved.addListener(n))},c=async()=>{await r.B.hasBookmarksPermission()&&(chrome.bookmarks.onCreated.removeListener(a),chrome.bookmarks.onChanged.removeListener(t),chrome.bookmarks.onRemoved.removeListener(n))}},81220:(s,e,o)=>{o.d(e,{GR:()=>m,Ln:()=>t,Ob:()=>n,Qj:()=>a,jl:()=>i});var r=o(45844);const i=async()=>{const s=await chrome.bookmarks.getTree(),e=c(s);return[s,e,t(e)]},a=s=>c(s),t=s=>s.filter((s=>{var e;return"0"!=s.id&&s.children&&(null===(e=m(s))||void 0===e?void 0:e.length)>0})),n=(s,e,o)=>{const i=(0,r.Z)(s);return i.forEach(((s,e)=>o=>{const r=o=>{o.id===s?Object.assign(o,e):o.children&&o.children.forEach(r)};return r(o)})(e,o)),i},m=s=>{var e;return s?null===(e=s.children)||void 0===e?void 0:e.filter((s=>s.url)):[]};function c(s,e){return s.reduce(((s,o)=>(s.push({id:o.id,parentId:(null==e?void 0:e.id)||"",title:o.title,url:o.url,children:o.children,index:o.index}),o.children&&s.push(...c(o.children,o)),s)),[])}}}]);