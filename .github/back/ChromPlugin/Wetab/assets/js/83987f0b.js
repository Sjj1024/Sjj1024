"use strict";(globalThis.webpackChunkinfinity_hitab_client=globalThis.webpackChunkinfinity_hitab_client||[]).push([[9621],{78481:(t,a,e)=>{e.d(a,{_:()=>s,pg:()=>n,zu:()=>l});var o=e(74003),i=e(88287),r=e(63477);const s=async t=>{try{var a;const e=await i.hj.get(`${o.H}stock/hq`,{codes:t},{_delay:0});if(0===e.rc&&(null===(a=e.data.diff)||void 0===a?void 0:a.length)>0)return[null,e.data.diff];throw e}catch(t){return["catch error"]}},n=async t=>{try{const a=await i.hj.get(`${o.H}stock/search`,{key:t},{_delay:0});if(a.QuotationCodeTable.Data&&a.QuotationCodeTable.Data.length>0)return[null,a.QuotationCodeTable.Data];throw a}catch(t){return["catch error"]}},l=async t=>{try{const a=await i.hj.get(`${o.H}stock/kline`,t,{_delay:0});if(0===a.rc&&a.data.klines)return[null,a.data.klines];throw a}catch(t){return["catch error"]}};new r._P("stock/chart-data",18e5)},39621:(t,a,e)=>{e.r(a),e.d(a,{useStockStore:()=>u});const o=[{QuoteID:"1.000001",Code:"000001",Name:"上证指数",Classify:"Index",MktNum:"1",SecurityTypeName:"指数",trend:"up"},{QuoteID:"0.399001",Code:"399001",Name:"深证成指",Classify:"Index",MktNum:"0",SecurityTypeName:"指数",trend:"up"},{QuoteID:"0.399006",Code:"399006",Name:"创业板指",Classify:"Index",MktNum:"0",SecurityTypeName:"指数",trend:"up"},{QuoteID:"100.HSI",Code:"HSI",Name:"恒生指数",Classify:"HK",MktNum:"100",SecurityTypeName:"指数",trend:"down"}];var i=e(28850),r=e(10435),s=e(78481),n=e(94119),l=e(24581),c=e(57268);const u=(0,r.Q_)(i.BU.stock,{syncStorage:{watch:["followStocks","trendChartData","hqData"]},syncCloud:{watch:["followStocks"]},state:()=>({modalShow:!1,stockColor:{up:"#FF4D4F",down:"#34C759"},trendChartData:{},followStocks:o,hqData:{},flipping:!1,flipingTimer:null,dragId:""}),getters:{fullStateFollowStocks(){return this.followStocks.map((t=>{var a,e;return{...t,trend:(null===(a=this.hqData[t.QuoteID])||void 0===a?void 0:a.f4)>=0?"up":"down",hq:this.hqData[t.QuoteID]||{},chartData:(null===(e=this.trendChartData[t.QuoteID])||void 0===e?void 0:e.data)||[]}}))},topFourSecidStr(){let t=this.followStocks.map((t=>t.QuoteID));return t.length>4&&(t=t.slice(0,4)),t.sort(),t}},actions:{setModal(t){n.G.setStatus(l.Rm.stock,t),this.modalShow=t},setFollowStocks(t){this.followStocks=t},setDragId(t){this.dragId=t},async reqStocksPrice(){const t=this.followStocks.map((t=>t.QuoteID)),[a,e]=await(0,s._)(t.join(","));if(a||!e)return;const o={};this.followStocks.forEach(((t,a)=>{o[t.QuoteID]=e[a]})),this.hqData=o},async getHomeChartData(t){const a=this.trendChartData[t],e=(new Date).valueOf();if(a&&e-a.updateTime<36e5)return a.data;const[o,i]=await(0,s.zu)({secid:t,klt:5,lmt:60});return o||!i?null:i.map((t=>{const a=t.split(","),e=Number(a[2]);return{time:a[0],value:e}}))},async reqStockTrendData(){const t=this.topFourSecidStr.map((async t=>await this.getHomeChartData(t))),a=await Promise.all(t),e=Object.assign({},this.trendChartData);this.topFourSecidStr.forEach(((t,o)=>{a[o]&&(e[t]={updateTime:(new Date).valueOf(),data:a[o]})})),this.trendChartData=e},dragSort(t,a){if(t===a)return;const e=[...this.followStocks],o=e.findIndex((t=>a===t.QuoteID)),i=e.findIndex((a=>t===a.QuoteID));-1!==o&&-1!==i&&(o>i?(e.splice(o+1,0,e[i]),e.splice(i,1)):(e.splice(o,0,e[i]),e.splice(i+1,1)),this.setFollowStocks(e),this.setFlipping(!0))},setFlipping(t){window.clearTimeout(this.flipingTimer),t&&(this.flipping=t,this.flipingTimer=window.setTimeout((()=>{this.flipping=!1}),200))}}}),d=u(),h=(0,r.Jk)(d);(0,c.YP)((()=>h.topFourSecidStr.value.join(",")),(()=>{d.reqStockTrendData(),d.reqStocksPrice()}),{immediate:!1})}}]);