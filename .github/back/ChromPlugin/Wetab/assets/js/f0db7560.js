"use strict";(globalThis.webpackChunkinfinity_hitab_client=globalThis.webpackChunkinfinity_hitab_client||[]).push([[8421,2168],{8421:(t,e,i)=>{i.r(e);var l=i(68398),o=i(96755),s=i(79282),a=i(43451),r=i(57268),n=i(29445),c=i(94209),h=i(72168),p=i(80661),d=i.n(p),u=i(45911);const x=t=>((0,r.dD)("data-v-621af8e8"),t=t(),(0,r.Cn)(),t),g={class:"modal-bg relative flex h-full flex-row-reverse"},v={class:"history-back-btn absolute top-0 right-0 z-[1] hidden bg-[#E8E8D5] p-[15px]"},f=[x((()=>(0,r._)("i",{class:"icon iconfont icon-toggle_s text-[18px] text-color-white"},null,-1)))],m={class:"relative float-right h-[148px] w-[120px]"},y=[x((()=>(0,r._)("div",{class:"absolute flex h-full w-full items-center justify-center rounded-[4px] bg-[rgba(0,0,0,0.4)] opacity-0 transition-all hover:opacity-100"},[(0,r._)("i",{class:"iconfont icon-magnifier_icon text-[20px] leading-[20px] text-[#FFFFFF]"})],-1)))],w={class:"absolute right-0 bottom-[25px] h-[20px] rounded-l-[4px] bg-[#1C1C1E] p-[4px] font-['STSong'] text-[12px] leading-[12px] text-[#FFFFFF]"},b={class:"mt-[8px] pb-[52px] font-['STSong'] text-[24px] font-medium leading-[24px] text-[#1C1C1E]"},_={class:"whitespace-pre-wrap font-['STSong'] text-[13px] leading-[22px] text-[#3A3A3C]"},S={class:"h-[103px] pt-[48px] text-center font-['STSong'] text-[24px] font-semibold leading-[24px] text-[#1C1C1E]"},C=x((()=>(0,r._)("div",{class:"h-[1px] w-full bg-[#000000] opacity-[0.05]"},null,-1))),D={class:"title-list fixed flex h-[536px] w-[360px] flex-col overflow-y-scroll pt-[12px] pb-[26px] scrollbar-none"},k=["id","onClick"],H={class:"mr-[16px] w-[45px] shrink-0 whitespace-nowrap text-right font-['STSong'] text-[14px] leading-[20px] text-[#1C1C1E]"},P={class:"absolute right-0 border-t-[8px] border-b-[8px] border-r-[9px] border-t-[transparent] border-b-[transparent] border-r-[#E8E8D5]"},F={class:"absolute flex h-full w-full flex-col items-center bg-[#d8d8c5eb]"},L={class:"mt-[72px] truncate font-['STSong'] text-[24px] font-medium leading-[24px] text-[#1C1C1E]"},N=["src"],T=x((()=>(0,r._)("p",{class:"flex h-[32px] w-[32px] items-center justify-center rounded-[16px] border-[2.5px] border-[#3A3A3C]"},[(0,r._)("i",{class:"iconfont icon-times_icon text-[20px] font-semibold text-[#3A3A3C]"})],-1))),U={class:"mt-[9px] font-['STSong'] text-[13px] leading-[22px] text-[#3A3A3C]"},A=(0,r.aZ)({__name:"widget-history-modal",setup(t){const e=(0,h.useHistoryStore)(),i=(0,n.iH)(0),o=(0,n.iH)({}),p=(0,n.iH)(!1),x=(0,n.iH)(),A=(0,n.iH)(),E=(0,n.iH)(!1);(0,r.YP)((()=>e.modalShow),(t=>{t&&(i.value=e.homePageNum-1,B())}));const j=(0,u.Z)((t=>{E.value=!0,i.value!=t&&(i.value=t,B())}),500,{leading:!0,trailing:!1}),B=()=>{var t;e.getHistoryDetail(null===(t=e.historyList[i.value])||void 0===t?void 0:t.e_id,!1).then((t=>{var e,l;null===(e=A.value)||void 0===e||e.scrollTo({top:0}),null===(l=document.getElementById("title_"+i.value))||void 0===l||l.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),o.value=t[0]||{}}))},M=t=>{p.value=t};return(t,h)=>{const u=a.Z,B=s.Z;return(0,r.wg)(),(0,r.j4)(B,{class:"widget-habit-modal",ani:"fade",show:(0,n.SU)(e).modalShow},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{"full-screen-btn":!1,onOnClose:h[5]||(h[5]=t=>(0,n.SU)(e).setModal(!1))},{default:(0,r.w5)((()=>{var t,s,a,u,B,z,I;return[(0,r._)("section",g,[(0,r._)("div",{ref_key:"contentRef",ref:A,class:"h-full w-full overflow-y-scroll bg-[#E8E8D5] px-[40px] pt-[77px] pb-[40px] scrollbar-none"},[(0,r.wy)((0,r._)("div",v,[(0,r._)("button",{class:"rounded-[6px] bg-color-black bg-opacity-10 p-[6px]",onClick:h[0]||(h[0]=t=>E.value=!1)},f)],512),[[l.vShow,E.value]]),(0,r.wy)((0,r._)("div",m,[(0,r._)("div",{class:"img-shadow relative float-right h-[128px] w-[100px] cursor-pointer rounded-[4px] bg-[#C0C0C0] transition-all",style:(0,c.normalizeStyle)({backgroundImage:null!==(t=o.value)&&void 0!==t&&t.picUrl&&null!==(s=o.value.picUrl[0])&&void 0!==s&&s.url?`url(${(null===(a=o.value)||void 0===a?void 0:a.picUrl)&&(null===(u=o.value.picUrl[0])||void 0===u?void 0:u.url)})`:"https://static.wetab.link/history/history_efault.jpg"}),onClick:h[1]||(h[1]=t=>M(!0))},y,4),(0,r._)("p",w,(0,c.toDisplayString)(`共${o.value.picNo}张`),1)],512),[[l.vShow,(null===(B=o.value)||void 0===B?void 0:B.picUrl)&&(null===(z=o.value.picUrl[0])||void 0===z?void 0:z.url)]]),(0,r._)("div",null,[(0,r._)("p",b,(0,c.toDisplayString)(o.value.title),1),(0,r._)("p",_,(0,c.toDisplayString)(o.value.content||""),1)])],512),(0,r._)("div",{class:(0,c.normalizeClass)(["history-side-bar h-full w-[360px] shrink-0 bg-[#D8D8C5]",[{"history-side-bar-show":!E.value}]])},[(0,r._)("p",S,(0,c.toDisplayString)("历史上的"+(0,n.SU)(d())().format("MM月DD日")),1),C,(0,r._)("div",D,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)((0,n.SU)(e).historyList,((t,e)=>((0,r.wg)(),(0,r.iD)("div",{id:"title_"+e,key:t.e_id,class:(0,c.normalizeClass)(["relative flex w-full flex-row items-center py-[16px] pl-[40px] pr-[16px] transition-all",[i.value==e?"bg-[#CCCBB5]":" hover:bg-[#D3D2BD]"]]),onClick:t=>(0,n.SU)(j)(e)},[(0,r._)("p",H,(0,c.toDisplayString)(t.date.split("年")[0]+"年"),1),(0,r._)("p",{class:(0,c.normalizeClass)(["my-text-ellipsis-title overflow-hidden font-['STSong'] text-[14px] leading-[20px]",[i.value==e?"bg-[#CCCBB5] font-medium text-[#1C1C1E]":"font-normal text-[#3A3A3C]"]])},(0,c.toDisplayString)(t.title),3),(0,r.wy)((0,r._)("div",P,null,512),[[l.vShow,i.value==e]])],10,k)))),128))])],2),(0,r.wy)((0,r._)("div",F,[(0,r._)("p",L,(0,c.toDisplayString)(o.value.title),1),(0,r._)("div",{ref_key:"scrollXRef",ref:x,class:(0,c.normalizeClass)(["mt-[44px] flex h-[378px] w-auto max-w-full shrink-0 flex-row items-center gap-[60px] overflow-x-scroll px-[44px] scrollbar-none",[1===Number(o.value.picNo)&&"justify-center"]]),onWheel:h[3]||(h[3]=t=>(t=>{const e=-t.wheelDelta?-t.wheelDelta/2:10*-t.deltaY;x.value.scrollLeft=x.value.scrollLeft+e/2})(t))},[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)((null===(I=o.value)||void 0===I?void 0:I.picUrl)||[],(t=>((0,r.wg)(),(0,r.iD)("div",{key:t.id,class:"flex h-full shrink-0 flex-col items-start justify-between"},[(0,r._)("img",{src:t.url,class:"modal-img-shadow h-[280px] w-auto min-w-[150px] rounded-[24px] border-[8px] border-[#FFFFFF] bg-[#C0C0C0]"},null,8,N),(0,r._)("p",{class:"mt-[28px] min-w-full max-w-min flex-1 overflow-y-scroll text-center font-['STSong'] text-[13px] leading-[22px] text-[#3A3A3C] scrollbar-none",onWheel:h[2]||(h[2]=(0,l.withModifiers)((()=>{}),["stop"]))},(0,c.toDisplayString)(t.pic_title),33)])))),128))],34),(0,r._)("div",{class:"flex flex-1 cursor-pointer flex-col items-center justify-end pb-[25px]",onClick:h[4]||(h[4]=t=>M(!1))},[T,(0,r._)("p",U,(0,c.toDisplayString)("返回"),1)])],512),[[l.vShow,p.value]])])]})),_:1})])),_:1},8,["show"])}}});const E=(0,i(76911).Z)(A,[["__scopeId","data-v-621af8e8"]]);var j=i(75008),B=i(63477);(()=>{const t=(0,B.em)(),e=(0,l.createApp)(E);(0,j.f)(e),e.use(o.M),e.mount(t)})()},72168:(t,e,i)=>{i.r(e),i.d(e,{useHistoryStore:()=>u,widgetInfo:()=>d});var l=i(10435),o=i(24581),s=i(28850),a=i(74003),r=i(88287);var n=i(80661),c=i.n(n),h=i(94119),p=i(63477);const d=(0,o.E0)(o.Rm.history),u=(0,l.Q_)(s.BU.history,{syncStorage:{watch:["historyList","lastTime","homePageNum"]},state:()=>({modalShow:!1,historyList:[],lastTime:0,homePageNum:1,homePageData:{}}),actions:{setModal(t){h.G.setStatus(o.Rm.history,t),this.modalShow=t},check(){var t;c()().isAfter(this.lastTime,"day")?this.queryHistoryList(c()().format("M/D")):this.getHistoryDetail(null===(t=this.historyList[this.homePageNum-1])||void 0===t?void 0:t.e_id)},async lastPage(){this.homePageNum>1&&(this.homePageNum-=1,this.homePageData=(await this.getHistoryDetail(this.historyList[this.homePageNum-1].e_id))[0])},async nextPage(){this.homePageNum<this.historyList.length&&(this.homePageNum+=1,this.homePageData=(await this.getHistoryDetail(this.historyList[this.homePageNum-1].e_id))[0])},async queryHistoryList(t){const[e,i]=await(async t=>{try{const e=await r.hj.get(`${a.H}history/list`,{date:t},{_delay:0});if(0===e.code&&e.data.length>0)return[null,e.data];throw e}catch(t){return["catch error"]}})(t);var l;e||(this.lastTime=Date.now(),this.homePageNum=1,this.historyList=i||[],this.getHistoryDetail(null===(l=this.historyList[this.homePageNum-1])||void 0===l?void 0:l.e_id))},async getHistoryDetail(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.historyList.findIndex((e=>e.e_id===t));let l;if(i>=0&&(l=this.historyList[i],l.content))return e&&(this.homePageData=l),[l];const[o,s=[]]=await(async t=>{try{const e=await r.hj.get(`${a.H}history/detail`,{id:t},{_delay:0});if(0===e.code&&e.data.length>0)return[null,e.data];throw e}catch(t){return["catch error"]}})(t);if(!o){var n;if(e)s[0].picUrl.length>0&&await(0,p.pt)(null===(n=s[0].picUrl[0])||void 0===n?void 0:n.url),this.homePageData=s[0];if(l){const t=JSON.parse(JSON.stringify(this.historyList));t[i]=Object.assign(l,s[0]),this.historyList=t}return s||[]}return[]}}})}}]);